<!DOCTYPE html>
<html>

<head>
  <title>Sent2Vec</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
  //window.sent2VecId = null;
  $(document).ajaxStart(function() {
    $(".loader").show();
  });
  $(document).ajaxStop(function() {
    $(".loader").hide();
  });
  $(document).ready(function(){
    // On clicking "Query" button, make POST to /knn with query sentence
    $("#submit-query").click(function(){
      if (window.sessionStorage.sent2VecId == null) {
        alert("Please encode some text first.");
        $("#input-text").focus();
      } else {
        $.post("knn",
                { query: $("#input-query").val(), id: window.sessionStorage.sent2VecId },
                function(data, status) {
                  html = formatKnnResult(JSON.parse(data));
                  $("#output-result").html(html);
                  $("#output-result").show();
               });
      }
    });

    // On clicking "Encode" button, make POST to /encode with text
    $("#submit-text").click(function(){
      $("#output-result").text("");
      $("#output-result").hide();
      $.post("encode",
              { text: $("#input-text").val() },
              function(data, status){
                window.sessionStorage.sent2VecId = JSON.parse(data)['id']
              }
      );
    });

    function formatKnnResult(result) {
      html = '<ol id="result-list">'
      for (var i = 0; i < result.sent.length; i++) {
        html += '<li>' + result.sent[i] + ' [' + result.dist[i] + ']</li>';
      }
      html += '</ol>';
      return html;
    }

  });
  </script>

</head>

<body>

  <main>

    <h1>Sent2Vec</h1>

    <div class="loader"></div>

    <div id="div-query">
      Enter query sentence:<br />
      <input id="input-query" type="text" name="query">
      <button id="submit-query">Query</button>
    </div>

    <div id="div-result">
      Result:<br />
      <div id="output-result"></div>
    </div>

    <div id="div-text">
      Enter text to encode:<br />
      <button id="submit-text">Encode</button>
      <textarea id="input-text"></textarea>
    </div>

  </main>

</body>

</html>
