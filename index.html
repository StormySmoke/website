<!DOCTYPE html>
<html>

<head>
  <title>Sent2Vec</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
  //window.sent2VecId = null;
  $(document).ajaxStart(function() {
    $(".loader").show();
  });
  $(document).ajaxStop(function() {
    $(".loader").hide();
  });
  $(document).ready(function(){
    $.ajaxSetup({
      timeout: 0
    });
    // On clicking "Query" button, make POST to /knn with query sentence
    $("#submit-query").click(function(){
      if (window.sessionStorage.sent2VecId == null) {
        alert("Please encode some text first.");
        $("#input-text").focus();
      } else {
        $.post("knn",
                { query: $("#input-query").val(), id: window.sessionStorage.sent2VecId },
                function(data, status, xhr) {
                  if (xhr.status == "200") {
                    html = formatKnnResult(JSON.parse(data));
                    $("#output-result").html(html);
                    $("#output-result").show();
                  }
                  else
                    alert("Server error: " + xhr.status);
               });
      }
    });

    // On clicking "Encode" button, make POST to /encode with text
    $("#submit-text").click(function(){
      $("#output-result").text("");
      $("#output-result").hide();
      $.post("encode",
              { text: $("#input-text").val() },
              function(data, status, xhr){
                if (xhr.status == "200")
                  window.sessionStorage.sent2VecId = JSON.parse(data)['id']
                else if (xhr.status == "503")
                  // This is NOT reached when the Heroku request timeout is hit
                  alert("Request timeout. Try with a shorter text.");
                else
                  alert("Server error: " + xhr.status);
              }
      );
    });

    function formatKnnResult(result) {
      html = '<ol id="result-list">'
      for (var i = 0; i < result.sent.length; i++) {
        html += '<li>' + result.sent[i] + '<ul><li>Distance: ' + Math.round(result.dist[i] * 1000000)/1000000 + '</li></ul>';
      }
      html += '</ol>';
      return html;
    }

  });
  </script>

</head>

<body>

  <main>

    <h1>Sent2Vec</h1>

      <div id="intro">
      <p><b>How does it work?</b></p>
      <ol>
        <li>Encode an arbitrary piece of text.</li>
        <li>Extract the sentences that are closest in meaning to a query sentence of your choice.</li>
      </ol>
      <p><b>Remember:</b> this application does not answer questions. It extracts the sentences from the text that are semantically most similar to your query sentence (its k-nearest-neighbours).</p>
      <p>To better see how it works, start by querying an exact copy of a sentence appearing in the text. Then alter one word, and so on, and observe the reported distances.</p>
      </div>
  
  

    <div class="loader"></div>

    <div id="div-query">
      <h2>Extract</h2>
      <p class="description">Enter a query sentence for which to find the k-nearest-neighbours.</p>
      <input id="input-query" type="text" name="query">
      <button id="submit-query">Extract</button>
    </div>

    <div id="div-result">
      <h2>Result</h2>
      <p class="description">The k-nearest-neighbours for your query sentence.</p>
      <div id="output-result"></div>
    </div>

    <div id="div-text">
      <h2>Encode</h2>
      <p class="description">Enter some text to encode.</p>
      <button id="submit-text">Encode</button>
      <textarea id="input-text"></textarea>
    </div>

  </main>

</body>

</html>
